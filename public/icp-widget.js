(function() { const script = document.currentScript; const config = { accountName: script.getAttribute("data-account-name"), param1: script.getAttribute("data-param1"), param2: script.getAttribute("data-param2"), param3: script.getAttribute("data-param3"), param4: script.getAttribute("data-param4"), containerId: script.getAttribute("data-container-id") || "icp-widget-container" }; if (!config.accountName || !config.param1 || !config.param2) { console.error("IClassPro Widget: Missing required parameters. Please provide data-account-name, data-param1, and data-param2."); return; } const widgetContainer = document.createElement("div"); widgetContainer.id = config.containerId; widgetContainer.style.cssText = "font-family: -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, Oxygen, Ubuntu, Cantarell, \"Open Sans\", \"Helvetica Neue\", sans-serif; max-width: 800px; margin: 0 auto; padding: 20px;"; widgetContainer.innerHTML = "<div style=\"text-align: center; padding: 20px;\">Loading classes...</div>"; document.currentScript.parentNode.insertBefore(widgetContainer, document.currentScript); async function loadClasses() { try { let url = `https://portal.iclasspro.com/${config.accountName}/classes?genders=${config.param1}&programs=${config.param2}`; if (config.param3) url += `&${config.param3}`; if (config.param4) url += `&${config.param4}`; const response = await fetch(`https://icp-widget-devcabins-projects.vercel.app/api/proxy?url=${encodeURIComponent(url)}`); const data = await response.json(); if (data && data.classes) { const classesHtml = data.classes.map(cls => `<div style="border: 1px solid #eee; border-radius: 8px; padding: 15px; margin-bottom: 15px; background: white; box-shadow: 0 2px 4px rgba(0,0,0,0.05);"><h3 style="margin: 0 0 10px 0; color: #333;">${cls.name}</h3><p style="margin: 0; color: #666;">${cls.description || "No description available"}</p><div style="margin-top: 10px; color: #888; font-size: 0.9em;"><span>${cls.capacity} spots</span> â€¢ <span>${cls.duration} minutes</span></div></div>`).join(""); widgetContainer.innerHTML = `<h2 style="text-align: center; margin-bottom: 20px; color: #333;">Available Classes</h2>${classesHtml}`; } else { widgetContainer.innerHTML = "<div style=\"text-align: center; padding: 20px; color: #666;\">No classes available at the moment.</div>"; } } catch (error) { console.error("Error loading classes:", error); widgetContainer.innerHTML = "<div style=\"text-align: center; padding: 20px; color: #ff4444;\">Error loading classes. Please try again later.</div>"; } } loadClasses(); })();
